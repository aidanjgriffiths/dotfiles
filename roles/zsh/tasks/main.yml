---

- name: Install  with Homebrew in macOS
  include_tasks: macos.yml
  when: ansible_distribution == "MacOSX"

- name: Install  with dnf in Fedora
  include_tasks: fedora.yml
  when: ansible_distribution == "Fedora"

- name: Install oh-my-zsh
  ansible.builtin.git:
    repo: https://github.com/robbyrussell/oh-my-zsh.git
    dest: ~/.oh-my-zsh
    single_branch: yes
    update: yes

- name: Install zsh-syntax-highlighting
  ansible.builtin.git:
    repo: https://github.com/zsh-users/zsh-syntax-highlighting.git
    dest: ~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting
    single_branch: yes

- name: Install zsh-autosuggestions
  ansible.builtin.git:
    repo: https://github.com/zsh-users/zsh-autosuggestions.git
    dest: ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions
    single_branch: yes

- name: Install conda-zsh-completion
  ansible.builtin.git:
    repo: https://github.com/conda-incubator/conda-zsh-completion
    dest: ~/.oh-my-zsh/custom/plugins/conda-zsh-completion
    single_branch: yes
    update: yes

- name: Create a symbolic to zshrc
  ansible.builtin.file:
    src: "{{ playbook_dir }}/zshrc"
    dest: "{{ ansible_env.HOME }}/.zshrc"
    state: link
    force: yes  # need to force in case .zshrc exists

- name: Create a symbolic to zshrc
  ansible.builtin.file:
    src: "{{ playbook_dir }}/zshrc"
    dest: "{{ ansible_env.HOME }}/.zshrc"
    state: link
    force: yes  # need to force in case .zshrc exists

- name: Initialise conda with zsh
  shell: "conda init zsh"
  register: result
  changed_when: 'result.stderr is search("modified")'
